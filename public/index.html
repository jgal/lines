<!---modified from krisrak / html-5-canvas-drawing-app on github -->

<!doctype html>
<html>
<head>
    <title>Lines</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" />
    <style type="text/css">
body {
    margin:0px;
    width:100%;
    height:100%;
    overflow:hidden;
    font-family:Arial;
    /* prevent text selection on ui */
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    /* prevent scrolling in windows phone */
    -ms-touch-action: none;
    /* prevent selection highlight */
    -webkit-tap-highlight-color: rgba(0,0,0,0);
}
        
.header {
    position: absolute;
    background-color: #222;
    text-align: center;
}
.header {
    top: 0px;
    left: 0px;
    right: 0px;
    height: 32px;
    padding:6px;
}

.title {
    width: auto;
    line-height: 32px;
    font-size: 20px;
    font-weight: bold;
    color: #eee;
    text-shadow: 0px -1px #000;
    padding:0 60px;
}
.navbtn {
    cursor: pointer;
    float:left;
    padding: 6px 10px;
    font-weight: bold;
    line-height: 18px;
    font-size: 14px;
    color: #eee;
    text-shadow: 0px -1px #000;
    border: solid 1px #111;
    border-radius: 4px;
    background-color: #404040;
    box-shadow: 0 0 1px 1px #555,inset 0 1px 0 0 #666;
    margin-right: 20px;     
}
.navbtn-hover, .navbtn:active {
    color: #222;
    text-shadow: 0px 1px #aaa;
    background-color: #aaa;
    box-shadow: 0 0 1px 1px #444,inset 0 1px 0 0 #ccc;   
}

.container {
    display: inline-block;
    position: relative;
    width: 30%;
    vertical-align: top;
}
.dummy {
    padding-top: 100%;
}
.element {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #6666ff;
}

#content{
    position: absolute;
    top: 44px;
    left: 0px;
    right: 0px;
    bottom: 0px;
    overflow:hidden;
    background-color:#00FFFF;
}
#content2{
    position: absolute;
    width: 50%;
    top: 44px;
    right: 0px;
    bottom: 0px;
    overflow:hidden;
    background-color:#ff99ff;
}

.canvasImg{
    position: absolute;
    overflow:hidden;
    background-color:#ddd;
    text-align: right;
    color: #eee;
    width: 100%;
}

#canvas{
    cursor:crosshair ;
    background-color:#F0F8FF;
}
.palette-case {
    width:260px;
    margin:auto;
    text-align:center;
}
.palette-box {
    float:left;
    padding:2px 6px 2px 6px;
}
.palette {
    border:2px solid #777;
    height:36px;
    width:36px;
}
    </style>
  <script type="text/javascript">
  
/*globals ibmdb */
/*eslint-env node */
(function() {
  // Union of Chrome, Firefox, IE, Opera, and Safari console methods
  var methods = ["assert", "cd", "clear", "count", "countReset",
    "debug", "dir", "dirxml", "error", "exception", "group", "groupCollapsed",
    "groupEnd", "info", "log", "markTimeline", "profile", "profileEnd",
    "select", "table", "time", "timeEnd", "timeStamp", "timeline",
    "timelineEnd", "trace", "warn"];
  var length = methods.length;
  var console = (window.console = window.console || {});
  var method;
  var noop = function() {};
  while (length--) {
    method = methods[length];
    // define undefined methods as noops to prevent errors
    if (!console[method])
      console[method] = noop;
  }
})();

var ctx, color = "#000";  
var num = 1;

document.addEventListener( "DOMContentLoaded", function(){
  // setup a new canvas for drawing wait for device init
    setTimeout(function(){
     newCanvas();
    }, 1000);
}, false );
// function to setup a new canvas for drawing
function newCanvas(){
  //define and resize canvas
  var dim = Math.min(window.innerWidth, window.innerHeight-90);
  document.getElementById("content").style.height = dim;
  var canvas = '<canvas id="canvas" width="'+dim+'" height="'+dim+'" align="middle"></canvas>';
  document.getElementById("content").innerHTML = canvas;
    
    // setup canvas
  ctx=document.getElementById("canvas").getContext("2d");
  ctx.strokeStyle = color;
  ctx.lineWidth = 5;  
  
  // setup to trigger drawing on mouse or touch
    drawTouch();
    drawPointer();
    drawMouse();
}

function saveImage() {
        // save canvas image as data url (png format by default)
      var dataURL = document.getElementById("canvas").toDataURL();

      // set canvasImg image src to dataURL
      // so it can be saved as an image
      var imgName = "img" + num;
      var img = document.getElementById(imgName);
      img.style.textAlign = "right";
      img.style.display = "inline";
      //img.src = "https://www.hallaminternet.com/assets/URL-tagging-image.png";  
      img.src = dataURL;

      document.getElementById(num).appendChild(img); 
	
	var connString = "DRIVER={DB2};DATABASE=SQLDB;HOSTNAME=75.126.155.153;UID=user04848;PWD=hjC8gSiSTzR1;PORT=50000;PROTOCOL=TCPIP";
	console.log("trying to connect to database...");
	var ibmdb;
	exports.route = function(req, res){
    	ibmdb = req.app.locals.ibmdb;
	}
	ibmdb.open(connString);
	/*	
		if (err)  ;
		else {
			var query = "insert into images (collaboration, position) values (2, 14);";
			var rows = conn.querySync(query);
				conn.close(function() {
					;
				});
		}
		*/
	
      if(num === 9) {num = 1;}
      else {
        num++;
      }
}

// prototype to start drawing on touch using canvas moveTo and lineTo
var drawTouch = function() {
  var start = function(e) {
    ctx.beginPath();
    x = e.changedTouches[0].pageX;
    y = e.changedTouches[0].pageY-44;
    ctx.moveTo(x,y);
  };
  var move = function(e) {
    e.preventDefault();
    x = e.changedTouches[0].pageX;
    y = e.changedTouches[0].pageY-44;
    ctx.lineTo(x,y);
    ctx.stroke();
  };
    document.getElementById("canvas").addEventListener("touchstart", start, false);
  document.getElementById("canvas").addEventListener("touchmove", move, false);
}; 
    
// prototype to start drawing on pointer(microsoft ie) using canvas moveTo and lineTo
var drawPointer = function() {
  var start = function(e) {
        e = e.originalEvent;
    ctx.beginPath();
    x = e.pageX;
    y = e.pageY-44;
    ctx.moveTo(x,y);
  };
  var move = function(e) {
    e.preventDefault();
        e = e.originalEvent;
    x = e.pageX;
    y = e.pageY-44;
    ctx.lineTo(x,y);
    ctx.stroke();
    };
    document.getElementById("canvas").addEventListener("MSPointerDown", start, false);
  document.getElementById("canvas").addEventListener("MSPointerMove", move, false);
};        
// prototype to start drawing on mouse using canvas moveTo and lineTo
var drawMouse = function() {
  var clicked = 0;
  var start = function(e) {
    clicked = 1;
    ctx.beginPath();
    x = e.pageX;
    y = e.pageY-44;
    ctx.moveTo(x,y);
  };
  var move = function(e) {
    if(clicked){
      x = e.pageX;
      y = e.pageY-44;
      ctx.lineTo(x,y);
      ctx.stroke();
    }
  };
  var stop = function(e) {
    clicked = 0;
  };
    document.getElementById("canvas").addEventListener("mousedown", start, false);
  document.getElementById("canvas").addEventListener("mousemove", move, false);
  document.addEventListener("mouseup", stop, false);
};
  </script>
</head>
<body>

<div id="page">
    <div class="header">
    <a id="new" class="navbtn" onclick="newCanvas()">Clear</a>
    <a id="save" class="navbtn" onclick="saveImage(); newCanvas();">Submit</a>
        <div class="title"><%= ibmdb %></div>
    </div>
    <div id="content"><p style="text-align:left">Loading canvas ... </p></div>
    <div id="content2">
        <div id="firstcontainer" class="container">
          <div class="dummy"></div>
          <div id="1" class="element"></div>
        </div
        ><div class="container">
          <div class="dummy"></div>
          <div id="2" class="element"></div>
        </div
        ><div class="container">
          <div class="dummy"></div>
          <div id="3" class="element"></div>
        </div
        ><div class="container">
          <div class="dummy"></div>
          <div id="4" class="element"></div>
        </div
        ><div class="container">
          <div class="dummy"></div>
          <div id="5" class="element"></div>
        </div
        ><div class="container">
          <div class="dummy"></div>
          <div id="6" class="element"></div>
        </div
        ><div class="container">
          <div class="dummy"></div>
          <div id="7" class="element"></div>
        </div
        ><div class="container">
          <div class="dummy"></div>
          <div id="8" class="element"></div>
        </div
        ><div class="container">
          <div class="dummy"></div>
          <div id="9" class="element"></div>
        </div>
        <img id="img1" class="canvasImg" style="display:none">
        <img id="img2" class="canvasImg" style="display:none">
        <img id="img3" class="canvasImg" style="display:none">
        <img id="img4" class="canvasImg" style="display:none">
        <img id="img5" class="canvasImg" style="display:none">
        <img id="img6" class="canvasImg" style="display:none">
        <img id="img7" class="canvasImg" style="display:none">
        <img id="img8" class="canvasImg" style="display:none">
        <img id="img9" class="canvasImg" style="display:none">
    </div>
</div> 
</body>
</html>
